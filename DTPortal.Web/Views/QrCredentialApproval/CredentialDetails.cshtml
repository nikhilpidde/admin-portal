@model DTPortal.Web.ViewModel.QrCredentialApproval.QrCredentialDetailsViewModel
<style>
    .table-container {
        max-height: 300px; /* Adjust the max height as needed */
        overflow-y: auto;
    }

    /* Alternating row colors */
    #data-attributes-list tbody tr:nth-child(even) {
        background-color: #f2f2f2; /* Light grey for even rows */
    }

    #data-attributes-list tbody tr:nth-child(odd) {
        background-color: #ffffff; /* White for odd rows */
    }

    /* Optional: Add a hover effect for rows */
    #data-attributes-list tbody tr:hover {
        background-color: #dcdcdc; /* Darker grey on hover */
    }

    .logo-container {
        max-width: 200px; /* Maximum width */
        max-height: 200px;
        height: 135px;
        width: 200px; /* Maximum height */
        border-radius: 4px;
        border: solid;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .logo-image {
        width: 100px;
        height: 100px;
        max-height: 120px;
        max-width: 120px;
    }

    #AttributeTable tbody tr:nth-child(odd) {
        background-color: transparent !important;
    }

</style>
<div class="row">
    <div class="col-md-12">
        <div class="card-custom">
            <div class="card-body">
                <form id="uform" enctype="multipart/form-data" asp-action="Update">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <!-- Full width for input fields and logo -->
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <div class="form-group" hidden>
                                <input asp-for="Id" class="form-control" />
                            </div>
                            <div class="form-group" hidden>
                                <input style="background-color:white;" asp-for="credentialUId" class="form-control" />
                            </div>
                            <div class="form-group">
                                <label asp-for="CredentialName" class="col-form-label"></label>
                                <input style="background-color:white;" asp-for="CredentialName" class="form-control" readonly />
                                <span asp-validation-for="CredentialName" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="organizationName" class="col-form-label"></label>
                                <input style="background-color:white;" asp-for="organizationName" class="form-control" readonly />
                                <span asp-validation-for="organizationName" class="text-danger"></span>
                            </div>
                            <!-- <div class="form-group">
                                  <label asp-for="createdDate" class="col-form-label"></label>
                                  <input asp-for="createdDate" class="form-control" readonly />
                                  <span asp-validation-for="createdDate" class="text-danger"></span>
                              </div>
                                -->
                        </div>

                        <div class="form-group col-md-6">
                            <div class="form-group">
                                <label asp-for="credentialUId" class="col-form-label"></label>
                                <input style="background-color:white;" asp-for="credentialUId" class="form-control" readonly />
                                <span asp-validation-for="credentialUId" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="status" class="col-form-label"></label>
                                <input style="background-color:white;" asp-for="status" class="form-control" readonly />
                                <span asp-validation-for="status" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Full width for Data Attributes table -->
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <label asp-for="dataAttributes" class="col-form-label s3">Public Attributes</label>

                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #D3D3D3;">
                                <table id="AttributeTable" class="table table-bordered table-hover table-checkable order-column full-width">
                                    <thead>
                                        <tr style="background-color: #F5F5F5; border-bottom: 2px solid #D3D3D3;">
                                            <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Attribute</th>
                                            <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Display Name</th>
                                            <th style="padding: 12px; text-align: center;">Data Type</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.dataAttributes.publicAttributes)
                                        {
                                            <tr style="border-bottom: 1px solid #E0E0E0;">
                                                <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.attribute</td>
                                                <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.displayName</td>
                                                <td style="padding: 10px; text-align: center;">
                                                    @{
                                                        string dataTypeName = item.dataType switch
                                                        {
                                                            1 => "Binary",
                                                            2 => "Boolean",
                                                            3 => "Integer",
                                                            4 => "String",
                                                            8 => "DateTime",
                                                            _ => "Unknown"
                                                        };
                                                        @dataTypeName
                                                    }
                                                </td>

                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Full width for Data Attributes table -->
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <label asp-for="dataAttributes" class="col-form-label s3">Private Attributes</label>

                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #D3D3D3;">
                                <table id="AttributeTable" class="table table-bordered table-hover table-checkable order-column full-width">
                                    <thead>
                                        <tr style="background-color: #F5F5F5; border-bottom: 2px solid #D3D3D3;">
                                            <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Attribute</th>
                                            <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Display Name</th>
                                            <th style="padding: 12px; text-align: center;">Data Type</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.dataAttributes.privateAttributes)
                                        {
                                            <tr style="border-bottom: 1px solid #E0E0E0;">
                                                <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.attribute</td>
                                                <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.displayName</td>
                                                <td style="padding: 10px; text-align: center;">
                                                    @{
                                                        string dataTypeName = item.dataType switch
                                                        {
                                                            1 => "Binary",
                                                            2 => "Boolean",
                                                            3 => "Integer",
                                                            4 => "String",
                                                            8 => "DateTime",
                                                            _ => "Unknown"
                                                        };
                                                        @dataTypeName
                                                    }
                                                </td>

                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Bottom buttons (Approve, Reject, Cancel) -->
                    <div class="d-flex justify-content-between align-items-center" style="padding-right: 10px; padding-top: 31px;">
                        @*                         <a type="button" id="previewButton" class="btn btn-primary mr-auto" data-toggle="modal" data-target="#previewModal">
                        View Consent Document
                        </a> *@

                        <div class="d-flex ml-auto">
                            @if (@Model.status == "APPROVAL_REQUIRED")
                            {
                                <a type="button" id="approveButton" class="btn btn-primary ml-2" data-toggle="modal">
                                    Approve
                                </a>
                                <a id="rejectButton" class="btn btn-danger ml-2">
                                    Reject
                                </a>
                            }
                            @if (@Model.status == "REJECTED")
                            {
                                <a id="remarks" class="btn btn-info ml-2" data-toggle="modal" data-target="#remarksModal">
                                    Remarks
                                </a>
                            }
                            <a asp-action="Index" class="btn btn-secondary ml-2">
                                Cancel
                            </a>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script>

        $(document).ready(function () {
            $('#walletMenu').addClass('active');
            $('#qrCredentialMenuItem').addClass('active');
            $('#walletConfig').addClass('show');
            $("li#walletMenu a:first").attr('aria-expanded', 'true');
            $("li#qrCredentialMenuItem a:first").attr('aria-expanded', 'true');

            /*For Breadcrumb Start*/
            $('#homeMenu').addClass('breadcrumb-item').append('Digital Wallet');
            $('#mainMenu').addClass('breadcrumb-item active').append('QrCredential Approval Details');
            $('#subMenu').addClass('breadcrumb-item').append('View');

            var table = $("#clientTable").DataTable({
                "bLengthChange": false,
                "searching": true,
                "ordering": true,
                "order": [[0, "desc"]]
            });
        });

        $(document).ready(function () {

            $("#approveButton").click(function () {
                var credentialUid = '@Model.credentialUId'; // Replace this dynamically if needed

                $.ajax({
                    url: '@Url.Action("Approve", "QrCredentialApproval")', // Update with your actual controller method
                    type: "POST",
                    data: { uid: credentialUid },
                    success: function (response) {
                        $('#approveModal').modal('hide');
                        window.location.href = '@Url.Action("Index", "QrCredentialApproval")';
                    },
                    error: function () {
                        window.location.href = '@Url.Action("Index", "QrCredentialApproval")';
                    }
                });
            });

            // Handle Reject button click
            $('#rejectButton').click(function () {
                $('#rejectModal').modal('show');
            });

            // Handle Reject form submission inside the modal
            $('#rejectForm').submit(function (e) {
                e.preventDefault(); // Prevent default form submission

                var credentialUId = '@Model.credentialUId';
                var remarks = $('#rejectRemarks').val();

                $.ajax({
                    url: '@Url.Action("Reject", "CredentialApproval")',
                    type: 'POST',
                    data: { uid: credentialUId, remarks: remarks },
                    success: function (response) {
                        $('#rejectModal').modal('hide');
                        window.location.href = '@Url.Action("Index", "CredentialApproval")';
                    },
                    error: function (xhr) {
                        window.location.href = '@Url.Action("Index", "CredentialApproval")';
                    }
                });
            });
        });

    </script>
}


@* approve credential modal *@
<div class="modal fade" id="approveModal" tabindex="-1" role="dialog" aria-labelledby="approveModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);">
            <div class="modal-header " style="border-bottom: 1px solid #ddd; padding: 12px 15px;">
                <h4 class="modal-title" id="approveModalLabel" style="font-weight: bold;text-align: center;width: 100%;">Note</h4>

            </div>
            <div class="modal-body" style="padding: 20px; font-size: 15px; line-height: 1.6;">

                <ul style="padding-left: 10px; margin-bottom: 0;list-style-type: none;">
                    <li>Upon Approval, the credential will be activated and published for all subscribers. Do you wish to proceed?</li>

                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" id="approveButton" class="btn btn-primary" style="padding: 6px 15px; border-radius: 6px; font-weight: 600; transition: 0.3s; cursor: pointer;">
                    Approve
                </button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" style="padding: 6px 15px; border-radius: 6px; border: 1px solid #ccc;">Cancel</button>

            </div>
        </div>
    </div>
</div>


@* reject modal *@
<div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rejectModalLabel">Reject Credential</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="rejectForm">
                    <div class="form-group">
                        <label for="rejectRemarks">Remarks</label>
                        <textarea id="rejectRemarks" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@* remarks modal *@
<div class="modal fade" id="remarksModal" tabindex="-1" role="dialog" aria-labelledby="remarksModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="remarksModalLabel">View Remarks</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @if (!string.IsNullOrEmpty(Model.remarks))
                {
                    <p class="text-left">@Model.remarks</p>
                }
                else
                {
                    <p>No remarks available.</p>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
