@{
    ViewData["Title"] = "Service Providers";
}

@{
    await Html.RenderPartialAsync("_AlertBox");
}

<style>
    .dataTables_wrapper .dataTables_paginate {
        white-space: nowrap;
        overflow-x: auto;
    }

    .dataTables_wrapper {
        overflow-x: auto;
    }

    table.dataTable {
        width: 100% !important;
    }

    /* Search input */
    .dataTables_filter input[type="search"] {
        padding-left: 2rem;
        border-radius: 20px;
        border: 1px solid #ccc;
        height: 38px;
        max-width: 300px;
        width:250px !important;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .dataTables_filter label {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 10px;
    }

    #statusFilter {
    min-width: 150px;
    padding-left: 8px;
}

    #serviceProvidersTable td,
    #serviceProvidersTable th {
        vertical-align: middle !important;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }


</style>


<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center flex-wrap mb-4 px-2 px-md-3">
            <!-- Heading -->
            <h4 class="mb-3 mb-md-0" style="letter-spacing: 0.5px;font-weight: 700;color: #22223b;font-size:20px !important;">
                Service Providers
            </h4>

            <!-- Filters -->
            <div class="d-flex align-items-center gap-3">
                <i class="fa fa-filter  text-dark mr-2" style="font-size:16px;"></i>
                <div class="position-relative">
                   
                    <select id="statusFilter" class="form-select form-select-sm ps-5 pe-4 py-2 rounded-3 border shadow-sm text-secondary"
                            style="background-color: #f9f9f9; min-width: 180px;">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Registered">Registered</option>
                    </select>
                  
                </div>
            </div>

        </div>



        <!-- DataTable -->
                <table id="serviceProvidersTable" class="table table-striped table-bordered table-hover w-100 p-0">
                    <thead>
                        <tr>
                            <th>Organization Name</th>
                            <th>Segment </th>
                            <th>Registration ID</th>
                            <th>Last KYC Date</th>
                            <th>Total KYC</th>
                            <th>KYC This Month</th>
                            <th>KYC Methods</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
    </div>
</div>


<script>
    $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("GetServiceProvidersList", "KycDashboard")',
            method: 'POST',
            success: function (response) {
                const data = response.data.map(item => ({
                    organizationName: item.organizationName,
                    segmentOrMinistry: item.segmentOrMinistry,
                    registrationId: item.registrationId,
                    lastKYCDate: item.lastKYCDate,
                    totalKYC: item.totalKYC,
                    kycThisMonth: item.kycThisMonth,
                    kycMethods: item.kycMethods.join(", "),
                    status: item.status
                }));

                const table = $('#serviceProvidersTable').DataTable({
                    data: data,
                    columns: [
                        { data: 'organizationName' },
                        { data: 'segmentOrMinistry' },
                        { data: 'registrationId' },
                        { data: 'lastKYCDate' },
                        { data: 'totalKYC' },
                        { data: 'kycThisMonth' },
                        { data: 'kycMethods' },
                        { data: 'status' }
                    ],
                    ordering: false,
                    responsive: true,
                    autoWidth: false,
                    pageLength: 10,
                    lengthChange: false,
                    language: {
                        searchPlaceholder: "Search service providers...",
                        search: ""
                    },
                   
                    dom: '<"d-flex justify-content-between align-items-center flex-wrap mb-3"f>rt<"bottom d-flex justify-content-between align-items-center px-3 pt-3"ip>'

                });

                // Filter dropdown logic
                $('#statusFilter').on('change', function () {
                    const selected = this.value;
                    if (selected) {
                        table.column(7).search('^' + selected + '$', true, false).draw();
                    } else {
                        table.column(7).search('').draw();
                    }
                });
            },
            error: function () {
                alert("Failed to load service provider data.");
            }
        });
    });
</script>
