@model DTPortal.Web.ViewModel.CredentialVerifiers.CredentialVerifierViewModel

<div class="row">
    <div class="col-md-12">
        <div class="card-custom">
            <div class="card-body">
                <form id="uform" enctype="multipart/form-data">
                    <div class="text-danger"></div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <input type="hidden" asp-for="Id" />

                            <div class="form-group">
                                <label class="col-form-label">Credential Name</label>
                                <input style="background-color:white;" class="form-control" asp-for="credentialName" disabled />
                            </div>
                            <div class="form-group">
                                <label class="col-form-label">Organization Name</label>
                                <input  style="background-color:white;" class="form-control" asp-for="organizationName" disabled />
                            </div>
                            <div class="form-group">
                                <label class="col-form-label">Created Date</label>
                                <input  style="background-color:white;" class="form-control" value="@Model.CreatedDate?.ToString("yyyy-MM-dd")" disabled />
                            </div>
                            <div class="form-group">
                                <label class="col-form-label">Selected Formats</label>

                                @if (Model.configuration == null || !Model.configuration.Any())
                                {
                                    <p class="text-muted">No configurations selected</p>
                                }
                                else
                                {
                                    <div id="configContainer" class="config-box">
                                        @foreach (var config in Model.configuration)
                                        {
                                            <div class="form-check mb-2">
                                                <input class="form-check-input custom-checkbox" type="checkbox" checked disabled>
                                                <label class="form-check-label mt-2">
                                                    @config.format
                                                </label>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>

                            <style>
                                /* Make sure the checkboxes are blue */
                                .custom-checkbox {
                                    appearance: none; /* Remove default styling */
                                    width: 15px;
                                    height: 15px;
                                    border: 2px solid #007bff; /* Blue border */
                                    background-color: #007bff; /* Blue background */
                                    border-radius: 3px;
                                    position: relative;
                                    margin-right: 8px; /* Space between checkbox and text */
                                    vertical-align: middle; /* Align with text */
                                }
                             

                                    .custom-checkbox:checked::after {
                                        content: '✔'; /* Custom checkmark */
                                        color: white;
                                        font-size: 12px;
                                        font-weight: bold;
                                        position: absolute;
                                        top: 50%;
                                        left: 50%;
                                        transform: translate(-50%, -50%);
                                    }

                                /* Ensure checkbox and text are on the same line */
                                .form-check {
                                    display: flex;
                                    align-items: center;
                                }

                                .form-check-label {
                                    vertical-align: middle;
                                }
                            </style>






                        </div>

                        <!-- Hierarchical Configurations -->
                        <!-- Subscriber Emails Section -->
                        <div class="form-group col-md-6">
                            <label asp-for="emails" class="col-form-label">Selected Verifier Emails</label>

                            <div style="height: 300px; overflow-y: auto;  padding: 10px; background-color: #fff;">
                                <table id="AttributeTable" class="table table-bordered">
                                    <thead>
                                        <tr style="background-color: #f8f9fa;">
                                            <th style="text-align: left; padding-left: 10px;">Emails</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.emails)
                                        {
                                            <tr>
                                                <td style="text-align: left; padding-left: 10px;">@item</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>



                    </div>

                    <!-- Data Attributes Section -->
                    <div class="form-group col-md-12">
                        <label asp-for="attributes" class="col-form-label s3">Attributes</label>

                        <div style="height: 300px; overflow-y: auto; border: 1px solid #D3D3D3;">
                            <table id="AttributeTable" class="table table-bordered table-hover table-checkable order-column full-width">
                                <thead>
                                    <tr style="background-color: #F5F5F5; border-bottom: 2px solid #D3D3D3;">
                                        <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Attribute</th>
                                        <th style="padding: 12px; text-align: center; border-right: 1px solid #E0E0E0;">Display Name</th>
                                        <th style="padding: 12px; text-align: center;">Data Type</th>
                                        <th style="padding: 12px; text-align: center;">Mandatory</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.attributes)
                                    {
                                        <tr style="border-bottom: 1px solid #E0E0E0;">
                                            <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.attribute</td>
                                            <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.displayName</td>
                                            <td style="padding: 10px; text-align: center;">
                                                @{
                                                    string dataTypeName = item.dataType switch
                                                    {
                                                        1 => "Binary",
                                                        2 => "Boolean",
                                                        3 => "Integer",
                                                        4 => "String",
                                                        8 => "DateTime",
                                                        _ => "Unknown"
                                                    };
                                                    @dataTypeName
                                                }
                                            </td>
                                            <td style="padding: 10px; border-right: 1px solid #E0E0E0; text-align: center;">@item.mandatory</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <div class="d-flex justify-content-between align-items-center" style="padding-right: 10px; padding-top: 31px;">
                        <div class="ml-auto d-flex">
                            @if (Model.status == "APPROVAL REQUIRED")
                            {
                                <a id="activateButton" class="btn btn-primary ml-2">
                                    Approve
                                </a>
                                <a id="rejectButton" class="btn btn-danger ml-2">
                                    Reject
                                </a>
                            }
                            @if (Model.status == "REJECTED")
                            {
                                <a id="remarks" class="btn btn-info ml-2" data-toggle="modal" data-target="#remarksModal">
                                    Remarks
                                </a>
                            }
                            <a asp-action="VerificationList" class="btn btn-secondary ml-2">
                                Cancel
                            </a>
                        </div>
                    </div>

                    <style>
                        .config-container {
                            padding: 10px;
                            background: #ffffff;
                            border-radius: 5px;
                            border: 1px solid #ddd;
                            max-height: 200px; /* Adjust height to match Subscriber Emails */
                            overflow-y: auto;
                        }

                        .config-box {
                            background: #fff;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            margin-bottom: 5px;
                            padding: 10px;
                        }

                        .config-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            cursor: pointer;
                            font-size: 13px;
                            font-weight: bold;
                            color: #4E5E6A;
                            padding: 8px 12px;
                            background: #f2f2f2;
                            border-radius: 4px;
                        }

                        #AttributeTable tbody tr:nth-child(odd) {
                            background-color: transparent !important;
                        }

                        .config-body {
                            padding: 10px;
                            font-size: 13px;
                            color: #4E5E6A;
                            background: #fff;
                            border-top: 1px solid #ddd;
                        }


                        .toggle-icon {
                            transition: transform 0.3s ease-in-out;
                        }

                        .config-header[aria-expanded="true"] .toggle-icon {
                            transform: rotate(180deg);
                        }

                        .config-body p {
                            text-align: left;
                            margin: 5px 0; /* Optional: Adds spacing for better readability */
                        }


                    
                    </style>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $('#walletMenu').addClass('active');
            $('#credentialVerificationElement').addClass('active');
            $('#walletConfig').addClass('show');

            $("li#walletMenu a:first").attr('aria-expanded', 'true');
            $("li#credentialMenuItem a:first").attr('aria-expanded', 'true');

            /*For Breadcrumb Start*/
            $('#homeMenu').addClass('breadcrumb-item').append('Wallet');
            $('#mainMenu').addClass('breadcrumb-item active').append('Subscription Approval List');
            $('#subMenu').addClass('breadcrumb-item').append('View');

         $('#data-attributes-list').DataTable({
            "paging": true,
            "searching": false,
            "ordering": true,
            "order": [[0, "asc"]],
            "lengthChange": false,
            "pageLength": 5  // Set 5 rows per page
        });
        });



        $('#activateButton').click(function () {
                var credentialUId = '@Model.Id';

                $.ajax({
                    url: '@Url.Action("ActivateCredential", "WalletVerification")',
                    type: 'POST',
                    data: { id: credentialUId },
                    success: function (response) {
                        window.location.href = '@Url.Action("VerificationList", "WalletVerification")';
                    },
                    error: function (xhr) {
                        window.location.href = '@Url.Action("VerificationList", "WalletVerification")';
                    }
                });
            });

            // Handle Reject button click
            $('#rejectButton').click(function () {
                $('#rejectModal').modal('show');
            });

            // Handle Reject form submission inside the modal
            $('#rejectForm').submit(function (e) {
                e.preventDefault(); // Prevent default form submission

                var credentialUId = '@Model.Id';
                var remarks = $('#rejectRemarks').val();

                $.ajax({
                    url: '@Url.Action("RejectCredential", "WalletVerification")',
                    type: 'POST',
                    data: { uid: credentialUId, remarks: remarks },
                    success: function (response) {
                        $('#rejectModal').modal('hide');
                        window.location.href = '@Url.Action("VerificationList", "WalletVerification")';
                    },
                    error: function (xhr) {
                        window.location.href = '@Url.Action("VerificationList", "WalletVerification")';
                    }
                });
            });



    </script>
}

<div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rejectModalLabel">Reject Credential</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="rejectForm">
                    <div class="form-group">
                        <label for="rejectRemarks">Remarks</label>
                        <textarea id="rejectRemarks" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="remarksModal" tabindex="-1" role="dialog" aria-labelledby="remarksModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="remarksModalLabel">View Remarks</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @if (!string.IsNullOrEmpty(Model.remarks))
                {
                    <p class="text-left">@Model.remarks</p>
                }
                else
                {
                    <p>No remarks available.</p>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Subscriber Emails Modal -->


<div id="emailModal" class="modal fade" tabindex="-1" aria-labelledby="emailModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="max-width: 500px;">
        <div class="modal-content rounded-3 shadow-sm border-0" style="max-height: 400px; overflow-y: auto;">
            <div class="modal-header">
                <h5 class="modal-title w-100 text-center" style="font-size: 18px; font-weight: 500; letter-spacing: 0.5px;">
                    Selected Subscriber Emails
                </h5>
                <button type="button" class="close btclick" data-dismiss="modal" aria-label="Close" style="outline: none; border: none; background: transparent; font-size: 22px;">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <ul style="padding-left: 20px; list-style-type: disc; list-style-position: inside; margin-bottom: 0;">
                    @if (Model != null && Model.emails.Any())
                    {
                        foreach (var email in Model.emails)
                        {
                            <li class="mb-2" style="font-size: 15px; color: #333; line-height: 1.5; padding-left: 5px;">
                                @email
                            </li>
                        }
                    }
                    else
                    {
                        <li class="text-muted" style="font-size: 15px;">No Emails Found</li>
                    }
                </ul>
            </div>
            <div class="modal-footer border-0 justify-content-end">
                <button class="btn btn-secondary btclick px-4 py-2 rounded-pill" data-dismiss="modal" style="font-size: 14px; font-weight: 500;">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

