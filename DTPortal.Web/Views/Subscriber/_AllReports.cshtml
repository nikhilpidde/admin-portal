@model PaginatedList<DTPortal.Core.DTOs.LogReportDTO>

@using DTPortal.Core

<div class="table-wrap">
    <div class="table-responsive">
        <table class="table display product-overview mb-30" id="support_table5">
            <thead>
                <tr>
                    <th>Operation</th>
                    @*  <th>Application Name</th> *@
                    <th>Message</th>
                    <th style="width:80px">Status</th>
                    <th style="width:80px">Integrity</th>
                    <th style="width:175px">Duration</th>
                    <th style="width:60px">Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Count() > 0)
                {
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ServiceName</td>
                            @* <td>@item.ServiceProviderAppName</td> *@
                            <td>@item.LogMessage</td>
                            <td>@item.LogMessageType</td>
                            <td>@(item.IsChecksumValid ? "Valid" : "Invalid")</td>
                            <td>
                                <span class="utc-time" data-utc="@item.StartTime"></span>
                                -
                                <span class="utc-time" data-utc="@item.EndTime"></span>
                            </td>
                            @* @if(item.ServiceName == "DIGITALLY_SIGNED"){
                    <td title="Sub Transactions" align="center">
                    <a class="btn-xs signing" asp-action="SubscriberSigningServiceReports" asp-route-correlationID="@item.CorrelationID">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 55.8 32.932">
                    <g id="Group_622" data-name="Group 622" transform="translate(-362.006 -1446.549)">
                    <path id="Path_54" data-name="Path 54" d="M362.006,1463.057c16.452-21.411,38.243-22.572,55.8-.088C401.021,1484.751,379.315,1485.189,362.006,1463.057Zm27.471,12.826a12.744,12.744,0,0,0,13.342-12.447,12.911,12.911,0,0,0-25.795-1.173C376.747,1469.827,382.088,1475.669,389.477,1475.883Zm16.324-5.743,7.886-7.18-7.886-7.027Zm-39.672-7.174,7.882,7.2v-14.226Z" transform="translate(0 0)" />
                    <path id="Path_55" data-name="Path 55" d="M395.125,1468.505c2.408-.369,4.972-.076,6.584-1.177,2.129-1.453,1.284-3.942-.227-5.876a6.578,6.578,0,0,1,7.643,2.507,7.86,7.86,0,0,1-9.4,11.946A7.268,7.268,0,0,1,395.125,1468.505Z" transform="translate(-12.93 -5.671)" />
                    </g>
                    </svg>
                    </a>
                    </td>
                    } *@
                            @if (item.ServiceName == "DIGITALLY_SIGNED")
                            {
                                <td title="Sub Transactions" align="center">
                                    <a id="eyeIcon-@item.CorrelationID" class="btn-xs signing" asp-action="SubscriberSigningServiceReports" asp-route-correlationID="@item.CorrelationID">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 55.8 32.932">
                                            <g id="Group_622" data-name="Group 622" transform="translate(-362.006 -1446.549)">
                                                <path id="Path_54" data-name="Path 54" d="M362.006,1463.057c16.452-21.411,38.243-22.572,55.8-.088C401.021,1484.751,379.315,1485.189,362.006,1463.057Zm27.471,12.826a12.744,12.744,0,0,0,13.342-12.447,12.911,12.911,0,0,0-25.795-1.173C376.747,1469.827,382.088,1475.669,389.477,1475.883Zm16.324-5.743,7.886-7.18-7.886-7.027Zm-39.672-7.174,7.882,7.2v-14.226Z" transform="translate(0 0)" />
                                                <path id="Path_55" data-name="Path 55" d="M395.125,1468.505c2.408-.369,4.972-.076,6.584-1.177,2.129-1.453,1.284-3.942-.227-5.876a6.578,6.578,0,0,1,7.643,2.507,7.86,7.86,0,0,1-9.4,11.946A7.268,7.268,0,0,1,395.125,1468.505Z" transform="translate(-12.93 -5.671)" />
                                            </g>
                                        </svg>
                                    </a>
                                </td>
                            }
                            else if (item.ServiceName == "SUBSCRIBER_AUTHENTICATED")
                            {
                                <td title="Sub Transactions" align="center">
                                    <a id="eyeIcon2-@item.CorrelationID" class="btn-xs signing" asp-action="SubscriberAuthenticationServiceReports" asp-route-correlationID="@item.CorrelationID">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 55.8 32.932">
                                            <g id="Group_622" data-name="Group 622" transform="translate(-362.006 -1446.549)">
                                                <path id="Path_54" data-name="Path 54" d="M362.006,1463.057c16.452-21.411,38.243-22.572,55.8-.088C401.021,1484.751,379.315,1485.189,362.006,1463.057Zm27.471,12.826a12.744,12.744,0,0,0,13.342-12.447,12.911,12.911,0,0,0-25.795-1.173C376.747,1469.827,382.088,1475.669,389.477,1475.883Zm16.324-5.743,7.886-7.18-7.886-7.027Zm-39.672-7.174,7.882,7.2v-14.226Z" transform="translate(0 0)" />
                                                <path id="Path_55" data-name="Path 55" d="M395.125,1468.505c2.408-.369,4.972-.076,6.584-1.177,2.129-1.453,1.284-3.942-.227-5.876a6.578,6.578,0,0,1,7.643,2.507,7.86,7.86,0,0,1-9.4,11.946A7.268,7.268,0,0,1,395.125,1468.505Z" transform="translate(-12.93 -5.671)" />
                                            </g>
                                        </svg>
                                    </a>
                                </td>
                            }
                            else
                            {
                                <td title="Sub Transactions" align="center">
                                    <a class="btn-xs signing" id="eyeIcon" onclick="showSwal()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 55.8 32.932">
                                            <g id="Group_622" data-name="Group 622" transform="translate(-362.006 -1446.549)">
                                                <path id="Path_54" data-name="Path 54" d="M362.006,1463.057c16.452-21.411,38.243-22.572,55.8-.088C401.021,1484.751,379.315,1485.189,362.006,1463.057Zm27.471,12.826a12.744,12.744,0,0,0,13.342-12.447,12.911,12.911,0,0,0-25.795-1.173C376.747,1469.827,382.088,1475.669,389.477,1475.883Zm16.324-5.743,7.886-7.18-7.886-7.027Zm-39.672-7.174,7.882,7.2v-14.226Z" transform="translate(0 0)" />
                                                <path id="Path_55" data-name="Path 55" d="M395.125,1468.505c2.408-.369,4.972-.076,6.584-1.177,2.129-1.453,1.284-3.942-.227-5.876a6.578,6.578,0,0,1,7.643,2.507,7.86,7.86,0,0,1-9.4,11.946A7.268,7.268,0,0,1,395.125,1468.505Z" transform="translate(-12.93 -5.671)" />
                                            </g>
                                        </svg>
                                    </a>
                                </td>
                            }

                        </tr>
                    }

                }
                else
                {
                    <tr>
                        <td colspan="6" align="center">No records found</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div>
    @{
        var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
        var nextDisabled = !Model.HasNextPage ? "disabled" : "";
    }

    <div class="row">
        <div class="col-sm-12 col-md-5">
            <div class="dataTables_info" id="dtHorizontalVerticalExample_info" style="margin-top: 1rem;" role="status" aria-live="polite">
                @if (Model.Count == 0)
                {
                    @:Showing 0 to 0 of 0
                }
                else
                {
                    var i = 100 - (100 - (Model.PageSize * (Model.PageIndex - 1))) + 1;
                    var j = i + Model.Count - 1;
                    var k = Model.TotalCount;

                    @:Showing @i to @j of @k
                }
            </div>
        </div>
        <div class="col-sm-12 col-md-7 paginationStyle">
            <div class="dataTables_paginate paging_simple_numbers" id="example4_paginate">
                <ul class="pagination">
                    <li class="paginate_button page-item previous @prevDisabled" id="example4_previous">
                        <a aria-controls="example4" data-dt-idx="0" tabindex="0" class="page-link signing" asp-action="SubscriberAllReportsByPage" asp-route-page="@(Model.PageIndex - 1)">Previous</a>
                    </li>
                    @{
                        int count = -2;
                        while (count <= 2)
                        {
                            var index = Model.PageIndex + count;

                            if (index > 0 && index < Model.TotalPages)
                            {
                                if (index == Model.PageIndex)
                                {
                                    <li class="paginate_button page-item active">
                                        <a aria-controls="example4" data-dt-idx="1" tabindex="0" class="page-link signing" asp-action="SubscriberAllReportsByPage" asp-route-page="@index">@index</a>
                                    </li>
                                }
                                else
                                {
                                    <li class="paginate_button page-item">
                                        <a aria-controls="example4" data-dt-idx="1" tabindex="0" class="page-link signing" asp-action="SubscriberAllReportsByPage" asp-route-page="@index">@index</a>
                                    </li>
                                }
                            }
                            count++;
                        }
                    }
                    <li class="paginate_button page-item next @nextDisabled" id="complex_header_next">
                        <a aria-controls="example4" data-dt-idx="0" tabindex="0" class="page-link signing" asp-action="SubscriberAllReportsByPage" asp-route-page="@(Model.PageIndex + 1)">Next</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
         updateUtcTimes();
        $('a.page-link.signing').click(function (e) {
            e.preventDefault();
            let href = $(this).attr('href'); 95
            $.ajax({
                type: "GET",
                url: href,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                beforeSend: function () {
                    $('#overlay').show();
                },
                complete: function () {
                    $('#overlay').hide();
                },
                success: function (data) {
                    $('#AllReports').html(data);
                },
                error: ajaxErrorHandler,
                failure: function (response) {
                    swal({ type: 'error', title: "Error", text: "Failed to process your request" });
                }
            });
        });

        // $('a.btn-xs.signing').click(function (e) {
        //     e.preventDefault();
        //     let href = $(this).attr('href');
        //     $.ajax({
        //         type: "GET",
        //         url: href,
        //         contentType: "application/json; charset=utf-8",
        //         datatype: "json",
        //         beforeSend: function () {
        //             $('#overlay').show();
        //         },
        //         complete: function () {
        //             $('#overlay').hide();
        //         },
        //         success: function (data) {
        //             $('#modalDialogContentDiv').html(data);
        //             $('#modalDialogDiv').modal('show');
        //         },
        //         error: ajaxErrorHandler,
        //         failure: function (response) {
        //             swal({ type: 'error', title: "Error", text: "Failed to process your request" });
        //         }
        //     });
        // });

        $(document).on('click', 'a[id^="eyeIcon-"]', function (e) {
            e.preventDefault();
            let href = $(this).attr('href');
            $.ajax({
                type: "GET",
                url: href,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                beforeSend: function () {
                    $('#overlay').show();
                },
                complete: function () {
                    $('#overlay').hide();
                },
                success: function (data) {
                    $('#modalDialogContentDiv').html(data);
                    $('#modalDialogDiv').modal('show');
                },
                error: ajaxErrorHandler,
                failure: function (response) {
                    Swal.fire({ icon: 'error', title: "Error", text: "Failed to process your request" });
                }
            });
        });
        $(document).on('click', 'a[id^="eyeIcon2-"]', function (e) {
            e.preventDefault();
            let href = $(this).attr('href');
            $.ajax({
                type: "GET",
                url: href,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                beforeSend: function () {
                    $('#overlay').show();
                },
                complete: function () {
                    $('#overlay').hide();
                },
                success: function (data) {
                    $('#modalDialogContentDiv').html(data);
                    $('#modalDialogDiv').modal('show');
                },
                error: ajaxErrorHandler,
                failure: function (response) {
                    Swal.fire({ icon: 'error', title: "Error", text: "Failed to process your request" });
                }
            });
        });
    });
    function showSwal() {
        swal({
            type: 'info',
            title: 'Info',
            text: 'Not available',
        });
    }
</script>

<script>
         // Update all datetime fields having ISO format: 2026-01-05T16:35:58.031

             function updateUtcTimes() {
        document.querySelectorAll(".utc-time").forEach(function (element) {
            const utcValue = element.getAttribute("data-utc");
            element.innerText = convertUtcToLocal(utcValue);
        });
    }


    function convertUtcToLocal(timestamp) {
        if (!timestamp) return "N/A";

        // Force UTC interpretation by appending Z
        const utcDate = new Date(timestamp.endsWith("Z") ? timestamp : timestamp + "Z");

        if (isNaN(utcDate)) return "Invalid Date";

        const day = String(utcDate.getDate()).padStart(2, "0");
        const month = String(utcDate.getMonth() + 1).padStart(2, "0");
        const year = utcDate.getFullYear();

        const hours = String(utcDate.getHours()).padStart(2, "0");
        const minutes = String(utcDate.getMinutes()).padStart(2, "0");
        const seconds = String(utcDate.getSeconds()).padStart(2, "0");

        return `${day}-${month}-${year} ${hours}:${minutes}:${seconds}`;
    }



</script>