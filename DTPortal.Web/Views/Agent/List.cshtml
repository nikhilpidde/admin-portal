@model DTPortal.Web.ViewModel.Agent.AgentListViewModel

@{
    ViewData["Title"] = "Agent";
}

@{
    await Html.RenderPartialAsync("_AlertBox");
}

<div class="row">
    <div class="col-md-12">
        <div class="card ">
            <div class="card-body ">
                <div class="row p-b-20">
                    <div class="col-md-6 col-sm-6 col-6">
                        <div class="btn-group">
                            <a class="btn btn-info greenButton" asp-action="Add">
                                <i class="fa fa-plus"></i>Add
                            </a>
                        </div>

                        <div class="btn-group">
                            <a class="btn btn-info greenButton" asp-action="List">
                                <i class="fa fa-refresh"></i>Refresh
                            </a>
                        </div>
                    </div>
                </div>
                <table class="table table-striped table-bordered table-hover table-checkable order-column full-width">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Mobile Number</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Agents)
                        {
                            <tr class="odd gradeX">
                                @if (item.Name == "")
                                {
                                    <td>N/A</td>
                                }
                                else
                                {
                                    <td>@item.Name</td>
                                }
                                <td>@item.Email</td>
                                <td>@item.MobileNumber</td>
                                <td>@item.Status</td>
                                <td class="valigntop" align="center">
                                    <div class="btn-group">
                                        <button class="btn btn-xs deepPink-bgcolor no-margin greenButton" type="button" data-toggle="dropdown"
                                                aria-expanded="false">
                                            Actions
                                            <i class="fa fa-angle-down"></i>
                                        </button>
                                        <ul class="dropdown-menu pull-left" role="menu">
                                            <li>
                                                <a asp-action="Edit" asp-route-id="@item.Id">
                                                    <i class="icon-pencil"></i>View
                                                </a>
                                                @if (item.Status == "ACTIVE")
                                                {
                                                    <a href="#" onclick="status(@item.Id)">
                                                        <i class="icon-pencil"></i>Deactivate
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="#" onclick="status(@item.Id)">
                                                        <i class="icon-pencil"></i>Active
                                                    </a>
                                                }
                                                @* <a href="#" onclick="DeleteAgent(@item.Id)">
                                            <i class="icon-pencil"></i>DeleteAgent
                                            </a> *@
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#assistedOnboardingMenu').addClass('active');
        $('#agentMenuItem').addClass('active');

        $('#assistedOnboarding').addClass('show');

        if ($('#sidebar ul li.dropdown.active')) {
            $('#sidebar ul li.dropdown.active ul').addClass('show');
            $('#rateCardMenuItem').addClass('active');
            $('#sidebar ul li.dropdown.active a.nav-link.drop-logo').attr('aria-expanded', 'true');
        }

        /*For Beadcrum Start*/
        $('#homeMenu').addClass('breadcrumb-item').append('Assisted Onboarding');
        $('#mainMenu').addClass('breadcrumb-item').append('Agent');
        $('#subMenu').removeClass('breadcrumb-item active');
        /*For Beadcrum End*/

        var table = $(".table").DataTable({
            "bLengthChange": false,
            "sort": false
        });
    });

    function status(id) {
        $.ajax({
            url: '@Url.Action("Status", "Agent")',
            type: 'POST',
            data: { id: id },
            beforeSend: function () {
                $('#overlay').show();
            },
            complete: function () {
                $('#overlay').hide();
            },
            success: function (response) {
                if (response.status == "Failed") {
                    swal({
                        title: 'Server response',
                        text: response.message,
                        type: 'info',
                    }, function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = '@Url.Action("List", "Agent")';
                        }
                    });
                }
                else {
                    swal({
                        title: 'Success',
                        text: response.message,
                        type: 'success',
                    }, function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = '@Url.Action("List", "Agent")';
                        }
                    });
                }
            }
        });
    }

    function DeleteAgent(id) {
        $.ajax({
            url: '@Url.Action("DeleteAgent", "Agent")',
            type: 'POST',
            data: { id: id },
            beforeSend: function () {
                $('#overlay').show();
            },
            complete: function () {
                $('#overlay').hide();
            },
            success: function (response) {
                if (response.status == "Failed") {
                    swal({
                        title: 'Server response',
                        text: response.message,
                        type: 'info',
                    }, function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = '@Url.Action("List", "Agent")';
                        }
                    });
                }
                else {
                    swal({
                        title: 'Success',
                        text: response.message,
                        type: 'success',
                    }, function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = '@Url.Action("List", "Agent")';
                        }
                    });
                }
            }
        });

    }


</script>